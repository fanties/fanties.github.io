<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Golang容器化部署最佳实践 | 知微坚果的拾光小镇</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="shortcut icon" href="http://picqq.oss-cn-shenzhen.aliyuncs.com//pic/md/favicon.ico">
    <link rel="stylesheet" href="//at.alicdn.com/t/font_3114978_qe0b39no76.css">
    <meta name="description" content="道虽迩，不行不至，事虽小，不为不成。">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <meta name="keywords" content="知微坚果,一念千秋,拾光小镇,Go,Golang开发,Java,Flutter,Kotlin,后端,架构">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.2c4acd8f.css" as="style"><link rel="preload" href="/assets/js/app.aefa215f.js" as="script"><link rel="preload" href="/assets/js/2.a2e47d19.js" as="script"><link rel="preload" href="/assets/js/46.16904a76.js" as="script"><link rel="preload" href="/assets/js/4.8618805e.js" as="script"><link rel="preload" href="/assets/js/8.0c0b2ac3.js" as="script"><link rel="preload" href="/assets/js/13.94a18eaf.js" as="script"><link rel="prefetch" href="/assets/js/10.9471f815.js"><link rel="prefetch" href="/assets/js/11.c8378516.js"><link rel="prefetch" href="/assets/js/12.6ac8a5f0.js"><link rel="prefetch" href="/assets/js/14.847033a3.js"><link rel="prefetch" href="/assets/js/15.7c4325b5.js"><link rel="prefetch" href="/assets/js/16.e96e5ab3.js"><link rel="prefetch" href="/assets/js/17.7546f5a3.js"><link rel="prefetch" href="/assets/js/18.be0fb2b2.js"><link rel="prefetch" href="/assets/js/19.9ef95fcf.js"><link rel="prefetch" href="/assets/js/20.5b6f55f6.js"><link rel="prefetch" href="/assets/js/21.c02217b3.js"><link rel="prefetch" href="/assets/js/22.9a7efe2f.js"><link rel="prefetch" href="/assets/js/23.e8703be7.js"><link rel="prefetch" href="/assets/js/24.bcb275f2.js"><link rel="prefetch" href="/assets/js/25.ef52f3f4.js"><link rel="prefetch" href="/assets/js/26.fc33ad9c.js"><link rel="prefetch" href="/assets/js/27.247160fc.js"><link rel="prefetch" href="/assets/js/28.85f03759.js"><link rel="prefetch" href="/assets/js/29.70302fd1.js"><link rel="prefetch" href="/assets/js/3.9db64edd.js"><link rel="prefetch" href="/assets/js/30.7df491ac.js"><link rel="prefetch" href="/assets/js/31.9e12a9ab.js"><link rel="prefetch" href="/assets/js/32.95df1632.js"><link rel="prefetch" href="/assets/js/33.ebb35b81.js"><link rel="prefetch" href="/assets/js/34.839bb7ff.js"><link rel="prefetch" href="/assets/js/35.40eacfdf.js"><link rel="prefetch" href="/assets/js/36.eddcdeb2.js"><link rel="prefetch" href="/assets/js/37.6e1a687e.js"><link rel="prefetch" href="/assets/js/38.4f3c4286.js"><link rel="prefetch" href="/assets/js/39.03cf763c.js"><link rel="prefetch" href="/assets/js/40.1393825d.js"><link rel="prefetch" href="/assets/js/41.c965769a.js"><link rel="prefetch" href="/assets/js/42.6085d2d8.js"><link rel="prefetch" href="/assets/js/43.89210b28.js"><link rel="prefetch" href="/assets/js/44.c4f41cdb.js"><link rel="prefetch" href="/assets/js/45.47666a6a.js"><link rel="prefetch" href="/assets/js/47.63a8e7d9.js"><link rel="prefetch" href="/assets/js/48.74f5fefe.js"><link rel="prefetch" href="/assets/js/49.ee37b28a.js"><link rel="prefetch" href="/assets/js/5.04b89f6c.js"><link rel="prefetch" href="/assets/js/50.82710bea.js"><link rel="prefetch" href="/assets/js/51.04b5f741.js"><link rel="prefetch" href="/assets/js/52.1297b7bc.js"><link rel="prefetch" href="/assets/js/6.92e03c58.js"><link rel="prefetch" href="/assets/js/7.f7306d6f.js"><link rel="prefetch" href="/assets/js/9.3a6ab990.js">
    <link rel="stylesheet" href="/assets/css/0.styles.2c4acd8f.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu have-body-img"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="http://picqq.oss-cn-shenzhen.aliyuncs.com//pic/md/8.svg" alt="知微坚果的拾光小镇" class="logo"> <span class="site-name can-hide">知微坚果的拾光小镇</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/speak/" class="nav-link">随笔</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="语言" class="dropdown-title"><a href="/language/" class="link-title">语言</a> <span class="title" style="display:none;">语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Golang</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/go/basic/" class="nav-link">基础</a></li><li class="dropdown-subitem"><a href="/go/lib/" class="nav-link">第三方库</a></li></ul></li><li class="dropdown-item"><h4>前端</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/front/vue/" class="nav-link">Vue</a></li><li class="dropdown-subitem"><a href="/front/flutter/" class="nav-link">Flutter</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具" class="dropdown-title"><a href="/tools/" class="link-title">工具</a> <span class="title" style="display:none;">工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/dev/" class="nav-link">开发工具</a></li><li class="dropdown-item"><!----> <a href="/sys/" class="nav-link">系统工具</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="项目" class="dropdown-title"><a href="/projects/" class="link-title">项目</a> <span class="title" style="display:none;">项目</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/inooy/timer" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Timer
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">时间线</a></li><li class="dropdown-item"><!----> <a href="/about/" class="nav-link">关于</a></li></ul></div></div> <a href="https://github.com/fanties" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://fanties.oss-cn-shenzhen.aliyuncs.com/avatar.jpeg"> <div class="blogger-info"><h3>知微坚果</h3> <span>行者常至，为者常成</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/speak/" class="nav-link">随笔</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="语言" class="dropdown-title"><a href="/language/" class="link-title">语言</a> <span class="title" style="display:none;">语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Golang</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/go/basic/" class="nav-link">基础</a></li><li class="dropdown-subitem"><a href="/go/lib/" class="nav-link">第三方库</a></li></ul></li><li class="dropdown-item"><h4>前端</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/front/vue/" class="nav-link">Vue</a></li><li class="dropdown-subitem"><a href="/front/flutter/" class="nav-link">Flutter</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具" class="dropdown-title"><a href="/tools/" class="link-title">工具</a> <span class="title" style="display:none;">工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/dev/" class="nav-link">开发工具</a></li><li class="dropdown-item"><!----> <a href="/sys/" class="nav-link">系统工具</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="项目" class="dropdown-title"><a href="/projects/" class="link-title">项目</a> <span class="title" style="display:none;">项目</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/inooy/timer" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Timer
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">时间线</a></li><li class="dropdown-item"><!----> <a href="/about/" class="nav-link">关于</a></li></ul></div></div> <a href="https://github.com/fanties" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>基础篇</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/99581a/" class="sidebar-link">Golang工程结构最佳实践</a></li><li><a href="/pages/a24792/" aria-current="page" class="active sidebar-link">Golang容器化部署最佳实践</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/a24792/#前言" class="sidebar-link">前言</a></li><li class="sidebar-sub-header level2"><a href="/pages/a24792/#一、最佳实践" class="sidebar-link">一、最佳实践</a></li><li class="sidebar-sub-header level2"><a href="/pages/a24792/#二、讲解" class="sidebar-link">二、讲解</a></li><li class="sidebar-sub-header level2"><a href="/pages/a24792/#_2-1-添加时区" class="sidebar-link">2.1 添加时区</a></li><li class="sidebar-sub-header level2"><a href="/pages/a24792/#_2-2-服务名" class="sidebar-link">2.2 服务名</a></li><li class="sidebar-sub-header level2"><a href="/pages/a24792/#_2-3-运行权限" class="sidebar-link">2.3 运行权限</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/a24792/#_2-3-1-linux-etc-passwd" class="sidebar-link">2.3.1 Linux /etc/passwd</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/a24792/#_2-4-docker分阶段构建" class="sidebar-link">2.4 Docker分阶段构建</a></li><li class="sidebar-sub-header level2"><a href="/pages/a24792/#三、docker基础镜像-base-image-scratch-、busybox、alpine" class="sidebar-link">三、Docker基础镜像（base image）：scratch 、busybox、alpine</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/a24792/#scratch-空镜像-基础镜像" class="sidebar-link">scratch：空镜像，基础镜像</a></li><li class="sidebar-sub-header level3"><a href="/pages/a24792/#busybox" class="sidebar-link">busybox</a></li><li class="sidebar-sub-header level3"><a href="/pages/a24792/#alpine" class="sidebar-link">Alpine</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/a24792/#参考资料" class="sidebar-link">参考资料</a></li></ul></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper bg-style-1"><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/categories/?category=%E3%80%8AGolang%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%E4%B8%93%E6%A0%8F%E3%80%8B" title="分类" data-v-06225672>《Golang微服务最佳实践专栏》</a></li><li data-v-06225672><a href="/categories/?category=%E5%9F%BA%E7%A1%80%E7%AF%87" title="分类" data-v-06225672>基础篇</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://flyoo.cn/" target="_blank" title="作者" class="beLink" data-v-06225672>知微坚果</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2022-11-30</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">Golang容器化部署最佳实践<span class="title-tag">优质</span></h1> <!----> <div class="theme-vdoing-content content__default"><h2 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h2> <p>相较于Java而言，Golang本身可以直接打包为各个平台的二进制文件，并不需要安装环境，所以直接采用虚拟机的方式部署也是非常方便的。</p> <p>但是如今云原生时代，部署并不仅仅是跑起来这么简单，还包括动态扩缩容、状态监控、资源管控等能力，容器化基本上是最佳选择。</p> <p>本文主要总结了Golang打包Docker的最佳实践，拥有非常小的体积，并且可以用于生产环境。</p> <h2 id="一、最佳实践"><a href="#一、最佳实践" class="header-anchor">#</a> 一、最佳实践</h2> <p>话不多说，先上可用域生产环境使用的Dockerfile文件：</p> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code><span class="token instruction"><span class="token keyword">FROM</span> golang:1.19-alpine3.16 <span class="token keyword">AS</span> builder</span>

<span class="token comment">#更新Alpine的软件源为国内源，提高下载速度</span>
<span class="token instruction"><span class="token keyword">RUN</span> echo <span class="token string">&quot;https://mirror.tuna.tsinghua.edu.cn/alpine/v3.16/main/&quot;</span> &gt; /etc/apk/repositories</span>
<span class="token instruction"><span class="token keyword">RUN</span> apk add --no-cache tzdata</span>
 
<span class="token instruction"><span class="token keyword">WORKDIR</span> /build</span>
<span class="token instruction"><span class="token keyword">RUN</span> adduser -u 10001 -D app-runner</span>
 
<span class="token instruction"><span class="token keyword">ENV</span> GOPROXY https://goproxy.cn</span>
<span class="token instruction"><span class="token keyword">COPY</span> go.mod .</span>
<span class="token instruction"><span class="token keyword">COPY</span> go.sum .</span>
<span class="token instruction"><span class="token keyword">RUN</span> go mod download</span>
 
<span class="token instruction"><span class="token keyword">COPY</span> . .</span>
<span class="token instruction"><span class="token keyword">RUN</span> CGO_ENABLED=0 GOARCH=amd64 GOOS=linux go build -a -o httpserver .</span>
 
<span class="token instruction"><span class="token keyword">FROM</span> alpine:3.16 <span class="token keyword">AS</span> final</span>
 
<span class="token instruction"><span class="token keyword">WORKDIR</span> /app</span>
<span class="token instruction"><span class="token keyword">COPY</span> <span class="token options"><span class="token property">--from</span><span class="token punctuation">=</span><span class="token string">builder</span></span> /build/httpserver /app/</span>
<span class="token comment">#COPY --from=builder /build/config /app/config</span>
<span class="token instruction"><span class="token keyword">COPY</span> <span class="token options"><span class="token property">--from</span><span class="token punctuation">=</span><span class="token string">builder</span></span> /etc/passwd /etc/passwd</span>
<span class="token instruction"><span class="token keyword">COPY</span> <span class="token options"><span class="token property">--from</span><span class="token punctuation">=</span><span class="token string">builder</span></span> /etc/ssl/certs/ca-certificates.crt /etc/ssl/certs/</span>

<span class="token comment"># 设置时区</span>
<span class="token instruction"><span class="token keyword">ENV</span> TZ Asia/Shanghai</span>
<span class="token instruction"><span class="token keyword">COPY</span> <span class="token options"><span class="token property">--from</span><span class="token punctuation">=</span><span class="token string">builder</span></span> /usr/share/zoneinfo/<span class="token variable">${TZ}</span> /usr/share/zoneinfo/<span class="token variable">${TZ}</span></span>

<span class="token instruction"><span class="token keyword">USER</span> app-runner</span>
<span class="token instruction"><span class="token keyword">ENTRYPOINT</span> [<span class="token string">&quot;/app/httpserver&quot;</span>]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">提示</p> <p>我们实际上使用的是分阶段打包镜像</p> <p>其实我们也可以先打包为Linux二进制文件，Dockerfile只把二进制文件COPY到镜像，但是这种方式打包环境和容器基础镜像提供的环境有所不同，而且还要首先安装golang环境，所以并不推荐采用这种方式。</p></div> <h2 id="二、讲解"><a href="#二、讲解" class="header-anchor">#</a> 二、讲解</h2> <ol><li>Golang运行只需要Linux内核</li> <li>Docker分阶段构建</li> <li>使用最小镜像alpha</li></ol> <h2 id="_2-1-添加时区"><a href="#_2-1-添加时区" class="header-anchor">#</a> 2.1 添加时区</h2> <p>aplha镜像默认时区是UTC，如果我们需要改为中国的时区，需要安装tzdata</p> <p>为了加速流水线下载速度，我添加镜像加速地址：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>RUN echo &quot;https://mirror.tuna.tsinghua.edu.cn/alpine/v3.16/main/&quot; &gt; /etc/apk/repositories
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>然后执行alpha镜像的安装命令：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>RUN apk add --no-cache tzdata
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>由于我们是在第一阶段的构建镜像中安装的时区，我们在第二阶段构建最终竟像时，需要把安装好的时区拷贝过去：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>ENV TZ Asia/Shanghai
COPY --from=builder /usr/share/zoneinfo/${TZ} /usr/share/zoneinfo/${TZ}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>我们通过ENV TZ的方式声明我们使用上海的时区，也就是北京时间了</p> <h2 id="_2-2-服务名"><a href="#_2-2-服务名" class="header-anchor">#</a> 2.2 服务名</h2> <p>我们上面打包golang的二进制名字为httpserver，并且启动命令也是httpserver，我们实际上可以通过哦ARG命令把该名字传入进来</p> <p>使用具体的具备业务含义的名字，这样的好处是查询对应的进程信息时，方便区分不同的服务容器</p> <h2 id="_2-3-运行权限"><a href="#_2-3-运行权限" class="header-anchor">#</a> 2.3 运行权限</h2> <div class="language- line-numbers-mode"><pre class="language-text"><code>USER app-runner
ENTRYPOINT [&quot;/app/httpserver&quot;]
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>在启动应用之前，先使用命令USER指定用户，这样后面运行的指令将只用指定用户的权限，可以增强安全性，避免应用漏洞导致服务器诶侵入。</p> <h3 id="_2-3-1-linux-etc-passwd"><a href="#_2-3-1-linux-etc-passwd" class="header-anchor">#</a> 2.3.1 Linux /etc/passwd</h3> <p>在Linux系统中，/etc/passwd是一个文件，存储基本用户信息，其中一行就代表一条用户信息。</p> <p>我们通过cat /etc/passwd，可以查看到如下信息：
<img src="http://picqq.oss-cn-shenzhen.aliyuncs.com//pic/md/20221202193957.png" alt="20221202193957"></p> <p>其中每一行被:分割为7个部分，对应的含义为：</p> <blockquote><p>用户名:口令:用户标识号:组标识号:注释性描述:主目录:登录Shell</p></blockquote> <h2 id="_2-4-docker分阶段构建"><a href="#_2-4-docker分阶段构建" class="header-anchor">#</a> 2.4 Docker分阶段构建</h2> <p>Docker 17.05版本以后，官方就提供了一个新的特性：Multi-stage builds（多阶段构建）。</p> <p>利用多阶段构建，我们可以在一个 Dockerfile 中使用多个 FROM 语句。每个 FROM 指令都可以使用不同的基础镜像，并表示开始一个新的构建阶段。</p> <p>我们可以很方便的将一个阶段的文件复制到另外一个阶段，在最终的镜像只需要保留必要的内容。</p> <p>通过这种方式，我们可以很容易实现Docker镜像的瘦身，最终镜像只保留运行时需要的内容，而构建期间用到的内容都可以不保存。</p> <h2 id="三、docker基础镜像-base-image-scratch-、busybox、alpine"><a href="#三、docker基础镜像-base-image-scratch-、busybox、alpine" class="header-anchor">#</a> 三、Docker基础镜像（base image）：scratch 、busybox、alpine</h2> <h3 id="scratch-空镜像-基础镜像"><a href="#scratch-空镜像-基础镜像" class="header-anchor">#</a> scratch：空镜像，基础镜像</h3> <p>scratch是Docker中预留的最小的基础镜像。bosybox 、 Go语言编译打包的镜像都可以基于scratch来构建。</p> <p>scratch镜像不在镜像仓库中，但是可以在Dockerfile引用。</p> <p>如：</p> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code><span class="token instruction"><span class="token keyword">FROM</span> scratch</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="busybox"><a href="#busybox" class="header-anchor">#</a> busybox</h3> <p>busybox镜像只有几兆。</p> <p>BusyBox是一个集成了一百多个最常用Linux命令和工具（如cat、echo、grep、mount、telnet等）的精简工具箱，它只有几MB的大小，很方便进行各种快速验证，被誉为“Linux系统的瑞士军刀”。BusyBox可运行于多款POSIX环境的操作系统中，如Linux（包括Android）、Hurd、FreeBSD等。</p> <h3 id="alpine"><a href="#alpine" class="header-anchor">#</a> Alpine</h3> <p>Alpine镜像比busybox大一点，也只有几兆。</p> <p>Alpine操作系统是一个面向安全的轻型Linux发行版。它不同于通常的Linux发行版，Alpine采用了musl libc和BusyBox以减小系统的体积和运行时资源消耗，但功能上比BusyBox又完善得多。在保持瘦身的同时，Alpine还提供了自己的包管理工具apk，可以通过https://pkgs.alpinelinux.org/packages查询包信息，也可以通过apk命令直接查询和安装各种软件。</p> <p>Alpine Docker镜像也继承了Alpine Linux发行版的这些优势。相比于其他Docker镜像，它的容量非常小，仅仅只有5MB左右（Ubuntu系列镜像接近200MB），且拥有非常友好的包管理机制。官方镜像来自docker-alpine项目。</p> <p>目前Docker官方已开始推荐使用Alpine替代之前的Ubuntu作为基础镜像环境。这样会带来多个好处，包括镜像下载速度加快，镜像安全性提高，主机之间的切换更方便，占用更少磁盘空间等。</p> <h2 id="参考资料"><a href="#参考资料" class="header-anchor">#</a> 参考资料</h2> <ol><li><a href="https://blog.csdn.net/kingu_crimson/article/details/126266971" target="_blank" rel="noopener noreferrer">Golang Dockerfile的最佳实践<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.cnblogs.com/beatleC/p/16056315.html" target="_blank" rel="noopener noreferrer">Golang - 如何使用Docker部署Go Web应用<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.cnblogs.com/jackluo/p/13576448.html" target="_blank" rel="noopener noreferrer">如何使用docker 部署 golang 编译环境最小版<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://www.asznl.com/post/48" target="_blank" rel="noopener noreferrer">docker基础镜像（base image）：scratch 、 busybox 、 alpine<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://blog.csdn.net/qq_34556414/article/details/78902662" target="_blank" rel="noopener noreferrer">Linux /etc/passwd<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://blog.csdn.net/zhongbeida_xue/article/details/105136672" target="_blank" rel="noopener noreferrer">Linux中/etc/passwd文件详细解析<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.jianshu.com/p/68c57153d968" target="_blank" rel="noopener noreferrer">Docker多阶段构建<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ol></div></div> <!----> <div class="page-edit"><!----> <div class="tags"><a href="/tags/?tag=Golang" title="标签">#Golang</a><a href="/tags/?tag=%E5%BE%AE%E6%9C%8D%E5%8A%A1" title="标签">#微服务</a><a href="/tags/?tag=%E5%90%8E%E7%AB%AF" title="标签">#后端</a></div> <div class="last-updated"><span class="prefix">更新时间:</span> <span class="time">12/5/2022, 9:00:10 PM</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/99581a/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">Golang工程结构最佳实践</div></a> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/99581a/" class="prev">Golang工程结构最佳实践</a></span> <!----></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/10dcf7/"><div>
            SpringBoot3.0快速上手
            <!----></div></a> <span class="date">12-07</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/13de43/"><div>
            Spring事务管理源码分析
            <!----></div></a> <span class="date">12-06</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/99581a/"><div>
            Golang工程结构最佳实践
            <!----></div></a> <span class="date">12-04</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:1244404139@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/fanties" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/#/playlist?id=503418750" title="听音乐" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2022-2022
    <span>知微坚果 | 拾光小镇<br> <a href="http://beian.miit.gov.cn/" target="_blank">蜀ICP备17001150号-2</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <div class="body-bg" style="background:url() center center / cover no-repeat;opacity:0.5;"></div> <!----> <!----></div><div class="global-ui"><div></div><div></div><div></div><canvas id="vuepress-canvas-cursor"></canvas><div></div><!----><div></div></div></div>
    <script src="/assets/js/app.aefa215f.js" defer></script><script src="/assets/js/2.a2e47d19.js" defer></script><script src="/assets/js/46.16904a76.js" defer></script><script src="/assets/js/4.8618805e.js" defer></script><script src="/assets/js/8.0c0b2ac3.js" defer></script><script src="/assets/js/13.94a18eaf.js" defer></script>
  </body>
</html>
